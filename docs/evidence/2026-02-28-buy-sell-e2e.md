# 2026-02-28 BUY/SELL E2E 검증 증적

## 범위
- BUY 1건 주문 접수 → 상태조회(`QUEUED`)
- SELL 1건 주문 접수 → 상태조회(`QUEUED`)
- 멱등성 시나리오
  - 동일 `Idempotency-Key` + 동일 Body: deduplicate(동일 `order_id`)
  - 동일 `Idempotency-Key` + 상이 Body: `409 IDEMPOTENCY_KEY_BODY_MISMATCH`

## 사전 조건
- 실주문 전송 없음 (in-memory queue 기반 테스트)
- 테스트 시간은 장중으로 고정(patch: `2026-01-02 10:00:00`)
- SELL 가능 수량은 테스트 더블로 주입(`get_available_sell_qty=5`)

## 1) Fail-first 증거
명령:
```bash
python3 -m unittest tests/test_order_e2e_buy_sell.py -v
```
결과(요약):
```text
test_buy_then_status_and_idempotency ... ok
test_runbook_evidence_and_readme_examples_exist ... FAIL
test_sell_then_status_and_idempotency_body_mismatch ... ok

FAILED (failures=1)
AssertionError: False is not true : E2E evidence doc is required
```

## 2) 최소 구현 반영
- `tests/test_order_e2e_buy_sell.py` 작성
  - BUY 주문 + 상태조회 + 동일 key 재호출 dedup 검증
  - SELL 주문 + 상태조회 + 동일 key 상이 body 충돌(409) 검증
  - 운영 증적 문서/README 예시 존재 검증
- `README.md`에 BUY/SELL 주문 실행 + 상태조회 + 멱등성 예시 추가
- 본 문서(`docs/evidence/2026-02-28-buy-sell-e2e.md`) 생성

## 3) E2E 재실행 PASS 증거
명령:
```bash
python3 -m unittest tests/test_order_e2e_buy_sell.py -v
```
결과:
```text
test_buy_then_status_and_idempotency ... ok
test_runbook_evidence_and_readme_examples_exist ... ok
test_sell_then_status_and_idempotency_body_mismatch ... ok

Ran 3 tests in 0.025s
OK
```

## 4) 회귀 일부 실행 PASS 증거
명령:
```bash
python3 -m unittest discover -s tests -v
```
결과(요약):
```text
Ran 85 tests in 0.256s
OK
```
